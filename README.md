# Recipe Assistant

## Problem Description

Cooking can be challenging, especially when trying to meet specific dietary needs, discover new recipes, or follow complex instructions. Traditional recipe books or static online lists often fail to offer the flexibility and interactivity needed to cater to individual preferences or dietary restrictions. Users often struggle to find recipes that fit their dietary preferences, adapt to their current ingredient availability, or need more guidance on how to prepare certain dishes.

The **Recipe Assistant** project addresses these challenges by providing an interactive AI-based app that helps users find and prepare recipes based on their dietary restrictions, discover new recipes, and receive step-by-step instructions. The app uses a dataset of diverse recipes to offer tailored recommendations and instructions, making cooking more accessible and enjoyable.

## Project Overview
 
The **Recipe Assistant** is a Retrieval-Augmented Generation (RAG) app that leverages the recipe dataset to provide an interactive experience for users. The main features of the app include:

1. Recipe Discovery: Users can search for new recipes based on cuisine type, difficulty level, or available ingredients.
2. Dietary Filters: The app can filter recipes according to dietary preferences such as vegan, gluten-free, or keto, helping users find recipes that meet their specific needs.
3. Step-by-Step Instructions: For each recipe, the app provides detailed, step-by-step instructions to guide users through the cooking process.
4. Chat Feature: Users can interact with the app via a chat interface to get recommendations, ask questions about recipes, and receive ingredient lists or cooking instructions in real-time.

This project aims to make cooking more accessible and enjoyable by providing a personalised and interactive recipe experience that adapts to the userâ€™s needs.

## Dataset

The dataset used for this project was generated by Claude and is located in [`data/data.csv`](data/data.csv). It contains 100 recipes with the following fields:

- `id`: Unique identifier for the recipe
- `recipe_name`: The name of the recipe
- `cuisine_type`: The type of cuisine the recipe belongs to
- `ingredients`: List of ingredients required for the recipe
- `cooking_instructions`: Step-by-step instructions to prepare the recipe
- `dietary_preferences`: Any dietary restrictions or preferences associated with the recipe (e.g., Vegan, Gluten-free)
- `difficulty`: The difficulty level of the recipe (Easy, Medium, Hard)


## Technologies

- Python 3.12
- Docker and Docker Compose for containerisation
- [Minsearch](https://github.com/alexeygrigorev/minsearch) for full-text search
- Flask as the API interface
- OpenAI as an LLM


## Preparation

We are using OpenAI so we need to provide the API key:

1. Install `direnv`.
2. Copy `.envrc_template` into `.envrc` and insert your key there.
3. For OpenAI, it's recommended to create a new project and use a separate key.
4. Run `direnv allow` to load the key into your environment.

For dependency management, we use pipenv, so you need to install it:

```bash
pip install pipenv
```

Once installed, you can install the app dependencies:

```bash
pipenv install --dev
```


## Running the application


### Database configuration

Before the application starts for the first time, the database
needs to be initialised.

First, run `postgres`:

```bash
docker-compose up postgres
```

Then run the [`db_prep.py`](recipe_assistant/db_prep.py) script:

```bash
pipenv shell

cd recipe_assistant

export POSTGRES_HOST=localhost
python db_prep.py
```

### CURL Testing

You can also use `curl` for interacting with the API:

```bash
URL=http://localhost:5000
QUESTION="How long does it take to prepare the pork broth for the ramen?"
DATA='{
    "question": "'${QUESTION}'"
}'

curl -X POST \
    -H "Content-Type: application/json" \
    -d "${DATA}" \
    ${URL}/ask
```

You will see something like the following in the response:

```json
{
  "answer": "It takes 12 or more hours to prepare the pork broth for the ramen.",
  "conversation_id": "52cf82c5-30f2-48ca-bcda-ba78b4f36a81",
  "question": "How long does it take to prepare the pork broth for the ramen?"
}
```

Sending feedback:

```bash
ID="52cf82c5-30f2-48ca-bcda-ba78b4f36a81"
URL=http://localhost:5000
FEEDBACK_DATA='{
    "conversation_id": "'${ID}'",
    "feedback": 1
}'

curl -X POST \
    -H "Content-Type: application/json" \
    -d "${FEEDBACK_DATA}" \
    ${URL}/feedback
```

After sending it, you'll receive the acknowledgement:

```json
{
  "conversation_id": "52cf82c5-30f2-48ca-bcda-ba78b4f36a81",
  "feedback": 1,
  "message": "Feedback received"
}
```

## Code

The code for the application is organized in the recipe_assistant directory:

- [`app.py`](recipe_assistant/app.py) - The Flask API serving as the main entry point for the application.
- [`rag.py`](recipe_assistant/rag.py) - Implements the core RAG logic for retrieving data and constructing prompts.
- [`ingest.py`](recipe_assistant/ingest.py) - Handles loading the recipe data into the knowledge base.
- [`minsearch.py`](recipe_assistant/minsearch.py) - An in-memory search engine for efficient data retrieval.
- [`db.py`](recipe_assistant/db.py) - Contains the logic for logging requests and responses to a PostgreSQL database.
- [`db_prep.py`](recipe_assistant/db_prep.py) - A script for initializing the database.